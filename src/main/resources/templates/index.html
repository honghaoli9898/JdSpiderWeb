<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title>登录界面</title>
		<!--<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" />-->
		<link href="../../plugins/css/bootstrap.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../plugins/css/basestyle.css" />
		<script>
			function clearform(){
				document.getElementById("en-form").reset();
			}
		</script>
	</head>
	<body>
		<!--以下只为网页效果，非真实应用程序-->
		<div class="box">
			<div class="header">
				<a class="header-logo" href="#">HBOOK快本</a>
				<div class="header-link">
					<a href="index" style="opacity:0.6;">简体中文</a>
					&nbsp;|&nbsp;
					<a href="english" target="_top">
						English
					</a>
				</div>
			</div>
			<div class="content">
				<div class="container">
					<div class="login-picture">
						<h2>快本,勿忘我！</h2>
						<p class="p1">
							这里，有你的盛世容颜<br />
							这里，有你的人生风景<br />
							收录，你的潇洒<br />
							载入，你的每一刻
						</p>
                        <p class="p2">
                        	快来加入<br />
                        	&nbsp;&nbsp;&nbsp;&nbsp;我们吧！
                        </p>
					</div>
					<div class="login-wrap">
						<div class="login-pattern">
						 	<ul>
						 		<li>快速登录</li>
						 		<li class="selected">账号密码登录</li>
						 	</ul>
						</div>
						<div id="login-tab">
							<div class="login-QRcode" id="login-QRcode">
							<div class="QRcode-wrap">
								<p class="p1">安全登录，防止被盗</p>
							    <div class="QRcode-content">
								    <img src="../../plugins/images/QRcode.png" alt="Login QRcode" /><!--这个二维码图片只为页面效果而添加，无实际意义-->
							    </div>
								<a href="#">使用快本手机版扫描登录</a></p>
							</div>
							<span class="QRcode-demo"></span>
							<div class="login-help">
								<a href="#registry" title="点我有惊喜！" data-toggle = "modal" data-target="#registry">注册新账号</a>
								&nbsp;|&nbsp;
								<a href="#">意见反馈</a>
							</div>
							
						</div>
						
						<div class="login-message login-default" id="login-message">
							<div id="login-hint"></div>
						 	<form id="login-form" action="islogin" method="post">
						 	    <div class="form-group col-lg-12 has-feedback">
						 	    	<label for="login-username" class="sr-only">账号</label>
						 	    	<input type="text" class="form-control" name="username" id="login-username" placeholder="手机号/用户名" autofocus="autofocus" required="required" />
						 	    	<span class="delUsername" id="delBtn">&times;</span>
						 	    </div>
						 		<div class="form-group col-lg-12">
						 			<label for="login-password" class="sr-only">密码</label>
						 	    	<input type="password" class="form-control" name="password" id="login-password" placeholder="密码" style="ime-mode: inactive;" required="required" />
						 	   </div>
						 	    <div class="form-group">
						 	    	<div class="checkbox col-lg-12">
						 	    		<label>
						 	    			<input type="checkbox" />记住密码
						 	    		</label>
						 	    	</div>
						 	    </div>
						 	    <div class="form-group col-lg-12">
						 		    <button type="button" class="btn btn-primary btn-block" id="login-btn">登录</button>
								    <button type="button" class="btn btn-default btn-block" data-toggle = "modal" data-target="#registry">注册</button>
						 	    </div>
						 	</form>
						 	<div class="login-help">
						 		<a href="#">忘记密码？</a>
						 		&nbsp;|&nbsp;
								<a href="#">意见反馈</a>
						 	</div>
						 </div>
						</div>
					</div>
				</div>
			</div>
			<div class="footer">
				<a href="#">关于我们</a>
				&nbsp;|&nbsp;
				<a href="#">客服中心</a>
				&nbsp;|&nbsp;
				<a href="#">联系我们</a>
				&nbsp;|&nbsp;
				<a href="#">帮助中心</a>
				&nbsp;|&nbsp;
				<span class="badging">&copy;1992 - 2018 Happybook Meon. All Rights Reserved.</span>
			</div>
		</div>
		
		<div class="modal fade" id="registry" tabindex="-1" role="dialog" aria-labelledby="ModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span  aria-hidden="true" style="font-size: 25px;" onclick="clearform()">&times;</span>
						</button>
						<h2 class="modal-title" id="ModalLabel" style="text-align: center;">注册</h2>
					</div>
					<div class="modal-body">
						<div class="container">
							<form class="form-horizontal" id="en-form" action="islogin" method="post">
							<div class="form-group">
									<label for="en-name" class="col-lg-1 col-md-2 col-sm-2 control-label">昵称：</label>
									<div class="col-lg-4 col-md-5 col-sm-7">
										<input type="text" class="form-control" name="name" id="en-name" required="required" />
										<p class="help-block hint_default default caution">请输入昵称 4到16位（字母，数字，下划线，减号）</p>
										<p class="help-block hint_warning glyphicon glyphicon-exclamation-sign" style="color: red;">输入的昵称不正确</p>
										<p class="help-block hint_succeed glyphicon glyphicon-ok-sign" style="color: green;">昵称可用</p>
										<p class="help-block hint_faile glyphicon glyphicon-exclamation-sign" style="color: red;">昵称已被使用</p>
									</div>
								</div>
							<div class="form-group">
						 	    <label for="en-username" class="col-lg-1 col-md-2 col-sm-2 control-label">账号：</label>
						 	    <div class="col-lg-4 col-md-5 col-sm-7">
						 	        <input type="text" class="form-control" name="usrname" id="en-username" required="required" />
						 	        <p class="help-block hint_0_default default caution">请使用邮箱注册</p>
						 			<p class="help-block hint_0_warning glyphicon glyphicon-exclamation-sign" style="color: red;">账号输入不正确</p>
						 			<p class="help-block hint_0_succeed glyphicon glyphicon-ok-sign" style="color: green;">账号可用</p>
						 			<p class="help-block hint_0_faile glyphicon glyphicon-exclamation-sign" style="color: red;">账号已注册</p>
						 	    </div>
						 	</div>
						 	<div class="form-group">
						 		<label for="en-password" class="col-lg-1 col-md-2 col-sm-2 control-label">密码：</label>
						 		<div class="col-lg-4 col-md-5 col-sm-7">
						 	        <input type="password" class="form-control" name="password" id="en-password" required="required" />
						 	        <p class="help-block hint_1_default default caution">8~18个字符，区分大小写</p>
						 			<p class="help-block hint_1_warning glyphicon glyphicon-exclamation-sign" style="color: red;">输入的密码太简单</p>
						 			<p class="help-block hint_1_succeed glyphicon glyphicon-ok-sign" style="color: green;"></p>
						 	   </div>
						 	</div>
						 	<div class="form-group">
						 	    <label for="checkpassword" class="col-lg-1 col-md-2 col-sm-2 control-label">确认密码：</label>
						 	    <div class="col-lg-4 col-md-5 col-sm-7">
						 	        <input type="password" class="form-control" name="checkpassword" id="checkpassword" required="required" />
						 	        <p class="help-block hint_2_default default caution">请再次填写密码</p>
						 			<p class="help-block hint_2_warning glyphicon glyphicon-exclamation-sign" style="color: red;">两次填写的密码不一致</p>
						 			<p class="help-block hint_2_succeed glyphicon glyphicon-ok-sign" style="color: green;"></p>
						 	    </div>
						 	</div>
						 	<div class="form-group">
						 		<label for="telephone" class="col-lg-1 col-md-2 col-sm-2 control-label">手机号码：</label>
						 		<div class="col-lg-4 col-md-5 col-sm-7">
						 			<input type="tel" class="form-control" name="telephone" id="telephone" />
						 			<p class="help-block hint_3_default default caution">忘记密码时，可通过该手机号码快速找回密码</p>
						 			<p class="help-block hint_3_warning glyphicon glyphicon-exclamation-sign" style="color: red;">请填写正确的手机号！</p>
						 			<p class="help-block hint_3_succeed glyphicon glyphicon-ok-sign" style="color: green;">手机号码可用</p>
						 		</div>
						 	</div>
						 	<div class="form-group">
						 		<div class="col-lg-offset-1 col-md-offset-2 col-sm-offset-2 col-lg-4 col-md-5 col-sm-7">
						 			<div class="checkbox">
						 				<label>
						 					<input type="checkbox" checked="checked" />同意&#34;<a href="#">服务条款</a>&#34;和&#34;<a href="#">隐私权相关政策</a>&#34;
						 				</label>
						 			</div>
						 		</div>
						 	</div>
						 	<div class="form-group col-lg-6 col-md-5 col-sm-7" style="text-align: center;">
						 		<button type="button" class="btn btn-primary" id="register-btn">立即注册</button>
						 	</div>
						</form>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearform()">退出</button>
					</div>
				</div>
			</div>
		</div>
		<script src="../../plugins/jquery/jquery-3.3.1.min.js"></script>
		<script src="../../plugins/js/bootstrap.min.js"></script>
		<script>
			$(document).ready(function() {
				$(".login-pattern li").each(function(index) {
					var liNode = $(this);
					$(this).on("click", function() {
						$(".login-pattern li.selected").removeClass("selected");
						liNode.addClass("selected");
						$("#login-tab .login-default").removeClass("login-default");
						$("#login-tab").children().eq(index).addClass("login-default");
					});
				});
				
				$(".QRcode-content").mouseover(function(){
					timeoutid = setTimeout(function(){
						$("span.QRcode-demo").css("display","block");
					},500);
				}).mouseout(function(){
					clearTimeout(timeoutid);
					$("span.QRcode-demo").css("display","none");
				});
				
				var LoginUsername = $("#login-username");
				var LoginPassword = $("#login-password");
				var delUsername = $(".delUsername");
				LoginUsername.on("input",function(){
					if (LoginUsername.val() != "" || LoginUsername.val() != null) {
					    delUsername.css("display","block");
				    }
				});
				LoginUsername.on("keyup",function(){
					if (LoginUsername.val() == "" || LoginUsername.val() == null){
				    	delUsername.css("display","none");
				    }
				});
		        delUsername.on("click",function(){
					LoginUsername.val("").focus();
					delUsername.css("display","none");
					$("#login-hint").text("请输入正确的账号！");
					delhint();
				});
				
				function delhint(){
					setTimeout("$('#login-hint').empty()",5000);
				};
				
				$("#login-btn").on("click",function(){
					if (LoginUsername.val() == "" || LoginUsername.val() == null) {
						$("#login-hint").text("你还没有输入账号！");
						delhint();
					} else if (LoginPassword.val() == "" || LoginPassword.val() == null) {
						$("#login-hint").text("你还没有输入密码！");
						delhint();
					}else{
						//document.getElementById('login-form').submit();
						var username = document.getElementById("login-username").value;
                        var password = document.getElementById("login-password").value;
                        var data = new FormData();
                        data.append("username",username);
                        data.append("password",password);
                        $.ajax({
                                url: 'islogin',
                                type: 'POST',
                                data: data,
                                contentType: false, //不设置内容类型
                                processData: false, //不处理数据
                                accept : "*/*",
                                beforeSend: function () {

                                },
                                success: function (result) {
                                    try {
                                        if(result==="true"){
                                        	window.location.href="search";
										}
                                        else{
                                        	window.location.href="login";
                                        	alert("登录失败,请重新登录!");
                                        }
                                    } catch (e) {
                                        window.alert(result);
                                    }
                                },
                                complete: function () {

                                },
                                error: function () {
                                    //请求失败时
                                }
                            }
                        ); 
					}
				});
				var enUserName = $("#en-name");
				var userNameReg = /^[a-zA-Z0-9_-]{4,16}$/;
				var checkNickName ;
				var checkUserId ;
				var checkPassword;
				var checkTelephone ;
				var checkSamePassword;
				function checkAll(){     
					console.log(checkNickName+".."+checkUserId+".."+checkPassword+".."+checkSamePassword+".."+checkTelephone);
					if(checkNickName&&checkUserId&&checkPassword&&checkSamePassword&&checkTelephone){      
				       return true;         
				    }else{           
				       return false;       
				    }    
				}   
				enUserName.on("blur",function () {
					if(enUserName.val()!="" && !userNameReg.exec(enUserName.val())){
					    enUserName.addClass("en_warning");
                        $("p.hint_default").removeClass("caution");
                        $("p.hint_warning").addClass("caution");
                        $("p.hint_faile").removeClass("caution");
                        checkNickName=false;
                    }
                    if(userNameReg.exec(enUserName.val())) {
                    	var content = enUserName.val();
                        var data = new FormData();
                        data.append("nickname",content);
                    	$.ajax({
                            url: 'isExistNickName',
                            type: 'POST',
                            data: data,
                            contentType: false, //不设置内容类型
                            processData: false, //不处理数据
                            accept : "*/*",
                            async : false,
                            beforeSend: function () {

                            },
                            success: function (result) {
                                try {
                                    if(result==="true"){
                                    	  $("p.hint_default").removeClass("caution");
                                    	  $("p.hint_faile").removeClass("caution");
                                    	  $("p.hint_warning").removeClass("caution");
                                          $("p.hint_succeed").addClass("caution");
                                          checkNickName = true;
    								}
                                    else{
                                    	$("p.hint_succeed").removeClass("caution");
                                    	enUserName.addClass("en_warning");
                                    	$("p.hint_default").removeClass("caution");
                                    	$("p.hint_warning").removeClass("caution");
                                    	$("p.hint_faile").addClass("caution");
                                    	checkNickName = false;
                                    }
                                } catch (e) {
                                    window.alert(result);
                                }
                            },
                            complete: function () {
                            },
                            error: function () {
                                //请求失败时
                            }
                        });
                    }
    		});
				enUserName.on("focus",function(){
					enUserName.removeClass("en_warning");
					$("p.hint_warning").removeClass("caution");
					$("p.hint_succeed").removeClass("caution");
					$("p.hint_faile").removeClass("caution");
                    $("p.hint_default").addClass("caution");
				});
				var enUserId = $("#en-username");
				var userReg = /^[a-z0-9]\w+@[a-z0-9]+(\.[a-z]{2,3}){1,2}$/i;
				enUserId.on("blur",function(){
					if (enUserId.val() != "" && !userReg.exec(enUserId.val())) {
                        enUserId.addClass("en_warning");
                        $("p.hint_0_default").removeClass("caution");
                        $("p.hint_0_faile").removeClass("caution");
                        $("p.hint_0_succeed").removeClass("caution");
                        $("p.hint_0_warning").addClass("caution");
                        checkUserId = false;
					}
					if (userReg.exec(enUserId.val())) {
						var content = enUserId.val();
                        var data = new FormData();
                        data.append("userid",content);
                    	$.ajax({
                            url: 'isExistUserId',
                            type: 'POST',
                            data: data,
                            contentType: false, //不设置内容类型
                            processData: false, //不处理数据
                            accept : "*/*",
                            async : false,
                            beforeSend: function () {

                            },
                            success: function (result) {
                                try {
                                    if(result==="true"){
                                    	 $("p.hint_0_default").removeClass("caution");
                 					    $("p.hint_0_succeed").addClass("caution");
                 					   $("p.hint_0_faile").removeClass("caution");
                 					   $("p.hint_0_warning").removeClass("caution");
                 					    checkUserId = true;
    								}
                                    else{
                                    	enUserId.addClass("en_warning");
                                        $("p.hint_0_default").removeClass("caution");
                                        $("p.hint_0_falie").addClass("caution");
                                        $("p.hint_0_succeed").removeClass("caution");
                                        $("p.hint_0_warning").removeClass("caution");
                                        checkUserId = false;
                                    }
                                } catch (e) {
                                    window.alert(result);
                                }
                            },
                            complete: function () {
                            },
                            error: function () {
                                //请求失败时
                            }
                        });
					}
				});
				enUserId.on("focus",function(){
					enUserId.removeClass("en_warning");
					$("p.hint_0_warning").removeClass("caution");
					$("p.hint_0_succeed").removeClass("caution");
					$("p.hint_0_faile").removeClass("caution");
                    $("p.hint_0_default").addClass("caution");
				});
				
				var enpwId = $("#en-password");
				var pwReg = /(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9]).{8,18}/;
				
				enpwId.on("blur",function(){
					if (!pwReg.exec(enpwId.val()) && enpwId.val() != "") {
                        enpwId.addClass("en_warning");
                        $("p.hint_1_default").removeClass("caution");
                        $("p.hint_1_warning").addClass("caution");
                        checkPassword = false;
					}
					if (pwReg.exec(enpwId.val())) {
						$("p.hint_1_default").removeClass("caution");
					    $("p.hint_1_succeed").addClass("caution");
					    checkPassword = true;
					}
				});
				enpwId.on("focus",function(){
					enpwId.removeClass("en_warning");
					$("p.hint_1_warning").removeClass("caution");
					$("p.hint_1_succeed").removeClass("caution");
                    $("p.hint_1_default").addClass("caution");
				});
				
				var checkpw = $("#checkpassword");
								
				checkpw.on("blur",function(){
					if (checkpw.val() != enpwId.val() && checkpw.val() != "") {
                        checkpw.addClass("en_warning");
                        $("p.hint_2_default").removeClass("caution");
                        $("p.hint_2_warning").addClass("caution");
                        checkSamePassword = false;
					} 
					if (checkpw.val() == enpwId.val() && checkpw.val() != "") {
						$("p.hint_2_default").removeClass("caution");
					    $("p.hint_2_succeed").addClass("caution");
					    checkSamePassword = true;
					}
				});
				checkpw.on("focus",function(){
					checkpw.removeClass("en_warning");
					$("p.hint_2_warning").removeClass("caution");
					$("p.hint_2_succeed").removeClass("caution");
                    $("p.hint_2_default").addClass("caution");
				});
				
				var telNum = $("#telephone");
				var telReg = /^1[3|4|5|7|8][0-9]\d{8}$/;
				telNum.on("blur",function(){
					if (telNum.val() == "" || telNum.val() == null || !telReg.exec(telNum.val())) {
                        telNum.addClass("en_warning");
                        $("p.hint_3_default").removeClass("caution");
                        $("p.hint_3_warning").addClass("caution");
                        checkTelephone = false;
					}
					if (telReg.exec(telNum.val())) {
					    $("p.hint_3_default").removeClass("caution");
					    $("p.hint_3_succeed").addClass("caution");
					    checkTelephone = true;
					}
				});
				telNum.on("focus",function(){
					telNum.removeClass("en_warning");
					$("p.hint_3_warning").removeClass("caution");
					$("p.hint_3_succeed").removeClass("caution");
                    $("p.hint_3_default").addClass("caution");
				});
				
				$(".modal button.btn-default").click(function(){
					reform();
				});
				$(".modal-header span").click(function(){
					reform();
				});
				function reform(){
					$(".modal p.help-block").removeClass("caution");
					$("p.default").addClass("caution");
					$("#en-form input").removeClass("en_warning");
				};
				//#register-btn
				$("#register-btn").on("click",function(){
					console.log(checkAll());
					if(checkAll()){
						var nickname = enUserName.val();
						var userid = enUserId.val();
						var password = enpwId.val();
						var telephone = telNum.val();
                        var data = new FormData();
                        data.append("nickname",nickname);
                        data.append("userid",userid);
                        data.append("password",password);
                        data.append("telephone",telephone);
                    	$.ajax({
                            url: 'register',
                            type: 'POST',
                            data: data,
                            contentType: false, //不设置内容类型
                            processData: false, //不处理数据
                            accept : "*/*",
                            async : false,
                            beforeSend: function () {

                            },
                            success: function (result) {
                                try {
                                    if(result==="true"){
                                    	alert("注册成功,请登录");
                                    	window.location.href="login";
    								}
                                    else{
                                    	alert("注册失败,请重试");
                                    }
                                } catch (e) {
                                    window.alert(result);
                                }
                            },
                            complete: function () {
                            },
                            error: function () {
                                //请求失败时
                            }
                        });
					}else{
						alert("请检查填写信息!");
					}
				})
			})
			

		</script>
	</body>
</html>
